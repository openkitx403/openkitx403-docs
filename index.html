<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenKitx403 - HTTP-Native Wallet Authentication for Solana</title>
    <meta name="description" content="Production-ready HTTP-native wallet authentication protocol for Solana. TypeScript & Python SDKs. LangChain & AI Agent support.">
    <!-- Favicons -->
    <link rel="icon" href="/assets/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/prism.css">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle navigation menu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1 style="padding-top:8px;">OpenKitx403</h1>
                    <span class="protocol-status">v0.1.0 ‚Ä¢ PRODUCTION</span>
                </div>
                <nav class="header-nav">
                    <a href="https://github.com/openkitx403/openkitx403" target="_blank" rel="noopener">GitHub</a>
                    <a href="#overview">Docs</a>
                    <a href="#quick-start">Quick Start</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container main-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-sticky">
                <div class="toc-header">Documentation</div>
                <nav class="toc">
                    <ul>
                        <li><a href="#overview" class="active">Overview</a></li>
                        <li><a href="#how-it-works">How It Works</a></li>
                        <li><a href="#quick-start">Quick Start</a></li>
                        <li>
                            <a href="#installation">Installation</a>
                            <ul>
                                <li><a href="#install-client">TypeScript Client</a></li>
                                <li><a href="#install-server-ts">TypeScript Server</a></li>
                                <li><a href="#install-server-py">Python Server</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#client-sdk">Client SDK</a>
                            <ul>
                                <li><a href="#client-browser">Browser Usage</a></li>
                                <li><a href="#client-nodejs">Node.js Usage</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#server-sdk">Server SDK</a>
                            <ul>
                                <li><a href="#server-express">Express</a></li>
                                <li><a href="#server-fastify">Fastify</a></li>
                                <li><a href="#server-fastapi">FastAPI</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#protocol-spec">Protocol Spec</a>
                            <ul>
                                <li><a href="#spec-headers">HTTP Headers</a></li>
                                <li><a href="#spec-challenge">Challenge Format</a></li>
                                <li><a href="#spec-verification">Verification</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#langchain">LangChain & AI Agents</a>
                        </li>
                        <li><a href="#security">Security</a></li>
                        <li><a href="#examples">Complete Examples</a></li>
                        <li><a href="#api-reference">API Reference</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Main Documentation Content -->
        <main class="content">
            <!-- Overview Section -->
            <section id="overview" class="doc-section">
                <h1>OpenKitx403</h1>
                <p class="subtitle">HTTP-native wallet authentication for Solana</p>
                
                <div class="feature-highlight">
                    <p>OpenKitx403 is an open-source, TypeScript-first protocol that standardizes <strong>HTTP 403</strong> as the semantic "prove you control this wallet" challenge for Solana wallet authentication.</p>
                </div>

                <div class="badges">
                    <span class="badge">‚úì Open Source</span>
                    <span class="badge">‚úì MIT License</span>
                    <span class="badge">‚úì Production Ready</span>
                    <span class="badge">‚úì Type-Safe</span>
                </div>

                <h2>Features</h2>
                <ul class="feature-list">
                    <li><strong>HTTP-Native:</strong> Uses standard HTTP 403 challenges, no custom protocols</li>
                    <li><strong>Stateless:</strong> No required server-side sessions</li>
                    <li><strong>Secure:</strong> Ed25519 signatures with replay protection</li>
                    <li><strong>Easy to use:</strong> Drop-in middleware for Express, Fastify, and FastAPI</li>
                    <li><strong>Production-ready:</strong> Full TypeScript and Python SDKs</li>
                    <li><strong>AI-friendly:</strong> LangChain integration and agent support</li>
                    <li><strong>Token-gating ready:</strong> Built-in support for NFT/token requirements</li>
                </ul>

                <h2>Why OpenKitx403?</h2>
                <p>Traditional web authentication requires centralized identity providers or long-lived sessions. OpenKitx403 enables <strong>stateless, cryptographic wallet-based authentication</strong> using standard HTTP semantics. It works with Phantom, Backpack, and Solflare wallets.</p>

                <div class="code-example">
                    <h3>Client Example</h3>
                    <pre><code class="language-typescript">import { OpenKit403Client } from '@openkitx403/client';

const client = new OpenKit403Client();
await client.connect('phantom');

const result = await client.authenticate({
  resource: 'https://api.example.com/protected'
});

console.log('‚úÖ Authenticated as:', result.address);</code></pre>
                </div>

                <div class="code-example">
                    <h3>Server Example</h3>
                    <pre><code class="language-typescript">import express from 'express';
import { createOpenKit403, inMemoryLRU } from '@openkitx403/server';

const app = express();

const openkit = createOpenKit403({
  issuer: 'my-api-v1',
  audience: 'https://api.example.com',
  replayStore: inMemoryLRU()
});

app.use(openkit.middleware());

app.get('/protected', (req, res) => {
  res.json({ wallet: req.openkitx403User.address });
});</code></pre>
                </div>
            </section>

            <!-- How It Works Section -->
            <section id="how-it-works" class="doc-section">
                <h2>How It Works</h2>
                <p>OpenKitx403 follows a simple challenge-response authentication flow:</p>

                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Client Request</h3>
                            <p>Client attempts to access protected resource</p>
                            <code class="inline-code">GET /protected</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Server Challenge</h3>
                            <p>Server responds with 403 + challenge</p>
                            <code class="inline-code">WWW-Authenticate: OpenKitx403 ...</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>User Signs</h3>
                            <p>Wallet signs the challenge</p>
                            <code class="inline-code">Ed25519 signature</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Client Retry</h3>
                            <p>Client resends with Authorization header</p>
                            <code class="inline-code">Authorization: OpenKitx403 ...</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h3>Success</h3>
                            <p>Server verifies signature and grants access</p>
                            <code class="inline-code">200 OK</code>
                        </div>
                    </div>
                </div>

                <h3>No JWTs, No Sessions, No Central Authority</h3>
                <p>OpenKitx403 is stateless-by-design. The server verifies each request cryptographically without maintaining session state.</p>
            </section>

            <!-- Quick Start Section -->
            <section id="quick-start" class="doc-section">
                <h2>Quick Start</h2>
                <p>Get running in 5 minutes.</p>

                <h3>1. Install Client</h3>
                <pre><code class="language-bash">npm install @openkitx403/client</code></pre>

                <h3>2. Install Server</h3>
                <pre><code class="language-bash"># TypeScript (Express/Fastify)
npm install @openkitx403/server

# Python (FastAPI)
pip install openkitx403</code></pre>

                <h3>3. Setup Server</h3>
                <pre><code class="language-typescript">import express from 'express';
import { createOpenKit403, inMemoryLRU } from '@openkitx403/server';

const app = express();

const openkit = createOpenKit403({
  issuer: 'my-api',
  audience: 'https://api.example.com',
  replayStore: inMemoryLRU()
});

app.use(openkit.middleware());

app.get('/protected', (req, res) => {
  res.json({ 
    message: 'Hello!', 
    wallet: req.openkitx403User.address 
  });
});

app.listen(3000);</code></pre>

                <h3>4. Setup Client</h3>
                <pre><code class="language-typescript">import { OpenKit403Client } from '@openkitx403/client';

const client = new OpenKit403Client();

// Connect wallet
await client.connect('phantom');

// Authenticate
const result = await client.authenticate({
  resource: 'http://localhost:3000/protected'
});

if (result.ok) {
  console.log('Success!', result.address);
}</code></pre>

                <div class="alert alert-info">
                    <strong>üí° Tip:</strong> See the <a href="#examples">Complete Examples</a> section for more detailed implementations.
                </div>
            </section>

            <!-- Installation Section -->
            <section id="installation" class="doc-section">
                <h2>Installation</h2>

                <h3 id="install-client">TypeScript Client</h3>
                <p>For browser and Node.js applications:</p>
                <pre><code class="language-bash">npm install @openkitx403/client</code></pre>

                <p><strong>Supports:</strong></p>
                <ul>
                    <li>Browser (Phantom, Backpack, Solflare wallets)</li>
                    <li>Node.js (with Solana keypair)</li>
                    <li>React, Vue, Svelte, etc.</li>
                </ul>

                <h3 id="install-server-ts">TypeScript Server</h3>
                <p>For Express and Fastify servers:</p>
                <pre><code class="language-bash">npm install @openkitx403/server</code></pre>

                <p><strong>Includes:</strong></p>
                <ul>
                    <li>Express middleware</li>
                    <li>Fastify plugin</li>
                    <li>Proper Ed25519 verification (@noble/ed25519)</li>
                    <li>In-memory replay store</li>
                </ul>

                <h3 id="install-server-py">Python Server</h3>
                <p>For FastAPI applications:</p>
                <pre><code class="language-bash">pip install openkitx403
# or
poetry add openkitx403</code></pre>

                <p><strong>Includes:</strong></p>
                <ul>
                    <li>FastAPI middleware</li>
                    <li>Ed25519 verification (pynacl)</li>
                    <li>Type hints and async support</li>
                </ul>
            </section>

            <!-- Client SDK Section -->
            <section id="client-sdk" class="doc-section">
                <h2>Client SDK</h2>

                <h3 id="client-browser">Browser Usage</h3>
                <p>Using OpenKitx403 in browser with wallet extensions:</p>

                <pre><code class="language-typescript">import { OpenKit403Client } from '@openkitx403/client';

const client = new OpenKit403Client();

// 1. Connect to wallet
await client.connect('phantom'); // or 'backpack' or 'solflare'

// 2. Authenticate with API
const result = await client.authenticate({
  resource: 'https://api.example.com/protected',
  method: 'GET'
});

if (result.ok) {
  console.log('Authenticated as:', result.address);
  const data = await result.response?.json();
  console.log('API response:', data);
} else {
  console.error('Auth failed:', result.error);
}</code></pre>

                <h4>React Example</h4>
                <pre><code class="language-typescript">import { useState } from 'react';
import { OpenKit403Client } from '@openkitx403/client';

function App() {
  const [client] = useState(() => new OpenKit403Client());
  const [address, setAddress] = useState<string>();

  const login = async () => {
    await client.connect('phantom');
    
    const result = await client.authenticate({
      resource: 'https://api.example.com/user/profile'
    });
    
    if (result.ok) {
      setAddress(result.address);
    }
  };

  return (
    <div>
      {!address ? (
        <button onClick={login}>Connect Wallet</button>
      ) : (
        <p>Connected: {address}</p>
      )}
    </div>
  );
}</code></pre>

                <h3 id="client-nodejs">Node.js Usage</h3>
                <p>Using OpenKitx403 in Node.js with Solana keypair:</p>

                <pre><code class="language-typescript">import { Keypair } from '@solana/web3.js';
import bs58 from 'bs58';
import fetch from 'node-fetch';

// Load keypair
const keypair = Keypair.fromSecretKey(
  bs58.decode('YOUR_SECRET_KEY_BASE58')
);

// 1. Get challenge
const response1 = await fetch('https://api.example.com/protected');

if (response1.status === 403) {
  const wwwAuth = response1.headers.get('WWW-Authenticate');
  const challengeMatch = wwwAuth?.match(/challenge="([^"]+)"/);
  const challengeB64 = challengeMatch![1];
  
  // 2. Decode and sign challenge
  const challengeJson = Buffer.from(challengeB64, 'base64url').toString();
  const challenge = JSON.parse(challengeJson);
  
  const signingString = buildSigningString(challenge);
  const message = Buffer.from(signingString);
  const signature = nacl.sign.detached(message, keypair.secretKey);
  
  // 3. Build Authorization header
  const authHeader = `OpenKitx403 addr="${keypair.publicKey.toBase58()}", sig="${bs58.encode(signature)}", challenge="${challengeB64}", ts="${new Date().toISOString()}", nonce="${generateNonce()}", bind="GET:/protected"`;
  
  // 4. Retry with auth
  const response2 = await fetch('https://api.example.com/protected', {
    headers: { 'Authorization': authHeader }
  });
  
  console.log('Success:', await response2.json());
}</code></pre>
            </section>

            <!-- Server SDK Section -->
            <section id="server-sdk" class="doc-section">
                <h2>Server SDK</h2>

                <h3 id="server-express">Express Middleware</h3>
                <pre><code class="language-typescript">import express from 'express';
import { createOpenKit403, inMemoryLRU } from '@openkitx403/server';

const app = express();

const openkit = createOpenKit403({
  issuer: 'my-api-v1',
  audience: 'https://api.example.com',
  ttlSeconds: 60,
  bindMethodPath: true,
  replayStore: inMemoryLRU()
});

// Apply to all routes
app.use(openkit.middleware());

// Or apply selectively
const protectedRouter = express.Router();
protectedRouter.use(openkit.middleware());

protectedRouter.get('/profile', (req, res) => {
  const user = req.openkitx403User;
  res.json({
    address: user.address,
    profile: { username: `User_${user.address.slice(0, 6)}` }
  });
});

app.use('/api', protectedRouter);
app.listen(3000);</code></pre>

                <h3 id="server-fastify">Fastify Plugin</h3>
                <pre><code class="language-typescript">import Fastify from 'fastify';
import { createOpenKit403, inMemoryLRU } from '@openkitx403/server';

const fastify = Fastify();

const openkit = createOpenKit403({
  issuer: 'my-api-v1',
  audience: 'https://api.example.com',
  replayStore: inMemoryLRU()
});

// Add as hook
fastify.addHook('onRequest', async (request, reply) => {
  const hook = openkit.fastifyHook();
  const result = await hook(request, reply);
  if (result) return reply.send(result);
});

fastify.get('/protected', async (request, reply) => {
  const user = request.openkitx403User;
  return { address: user.address };
});

fastify.listen({ port: 3000 });</code></pre>

                <h3 id="server-fastapi">FastAPI Middleware</h3>
                <pre><code class="language-python">from fastapi import FastAPI, Depends
from openkitx403 import (
    OpenKit403Middleware, 
    require_openkitx403_user,
    OpenKit403User
)

app = FastAPI()

# Add middleware
app.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",
    issuer="my-api-v1",
    ttl_seconds=60,
    bind_method_path=True,
    origin_binding=True,
    replay_backend="memory"
)

# Protected endpoint
@app.get("/protected")
async def protected(
    user: OpenKit403User = Depends(require_openkitx403_user)
):
    return {
        "message": "Hello!",
        "wallet": user.address
    }

# Exclude paths from auth
app.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",
    issuer="my-api-v1",
    excluded_paths=["/health", "/public"]
)</code></pre>

                <h3>Token Gating Example</h3>
                <pre><code class="language-typescript">// TypeScript
const openkit = createOpenKit403({
  issuer: 'my-api',
  audience: 'https://api.example.com',
  replayStore: inMemoryLRU(),
  
  // Require NFT/token ownership
  tokenGate: async (address: string) => {
    const conn = new Connection('https://api.mainnet-beta.solana.com');
    const pubkey = new PublicKey(address);
    
    const tokenAccounts = await conn.getParsedTokenAccountsByOwner(
      pubkey,
      { mint: new PublicKey('YOUR_TOKEN_MINT') }
    );
    
    return tokenAccounts.value.length > 0;
  }
});</code></pre>

                <pre><code class="language-python"># Python
from solana.rpc.api import Client

solana_client = Client("https://api.mainnet-beta.solana.com")

async def check_token(address: str) -> bool:
    """Check if wallet holds required token"""
    try:
        pubkey = PublicKey(address)
        response = solana_client.get_token_accounts_by_owner(
            pubkey,
            {"mint": PublicKey("YOUR_TOKEN_MINT")}
        )
        return len(response.value) > 0
    except:
        return False

app.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",
    issuer="my-api",
    token_gate=check_token
)</code></pre>
            </section>

            <!-- Protocol Specification Section -->
            <section id="protocol-spec" class="doc-section">
                <h2>Protocol Specification</h2>

                <h3 id="spec-headers">HTTP Headers</h3>

                <h4>Server ‚Üí Client (Challenge)</h4>
                <pre><code class="language-http">HTTP/1.1 403 Forbidden
WWW-Authenticate: OpenKitx403 realm="api-v1", version="1", challenge="eyJ2IjoxLCJhbGci..."
Content-Type: application/json

{
  "error": "wallet_auth_required",
  "detail": "Sign the challenge using your Solana wallet."
}</code></pre>

                <h4>Client ‚Üí Server (Authorization)</h4>
                <pre><code class="language-http">GET /protected HTTP/1.1
Host: api.example.com
Authorization: OpenKitx403 addr="5Gv8...", sig="3kYz...", challenge="eyJ2...", ts="2025-11-05T10:30:00Z", nonce="X8p2...", bind="GET:/protected"</code></pre>

                <h3 id="spec-challenge">Challenge Format</h3>
                <p>The challenge is a JSON object (base64url-encoded):</p>

                <pre><code class="language-json">{
  "v": 1,
  "alg": "ed25519-solana",
  "nonce": "E2o6p0q0Zl5PBjXc",
  "ts": "2025-11-05T10:30:00Z",
  "aud": "https://api.example.com",
  "method": "GET",
  "path": "/protected",
  "uaBind": false,
  "originBind": true,
  "serverId": "api-v1",
  "exp": "2025-11-05T10:31:00Z",
  "ext": {}
}</code></pre>

                <h4>Field Definitions</h4>
                <ul>
                    <li><strong>v</strong>: Protocol version (must be 1)</li>
                    <li><strong>alg</strong>: Algorithm (must be "ed25519-solana")</li>
                    <li><strong>nonce</strong>: Server-generated random value</li>
                    <li><strong>ts</strong>: Challenge creation timestamp</li>
                    <li><strong>aud</strong>: Target audience (origin URL)</li>
                    <li><strong>method</strong>: HTTP method</li>
                    <li><strong>path</strong>: Request path</li>
                    <li><strong>uaBind</strong>: Require User-Agent binding</li>
                    <li><strong>originBind</strong>: Require Origin binding</li>
                    <li><strong>serverId</strong>: Server identifier</li>
                    <li><strong>exp</strong>: Expiration timestamp (60s default)</li>
                    <li><strong>ext</strong>: Extension data for custom requirements</li>
                </ul>

                <h3>Signing String</h3>
                <p>The signing string is constructed as follows:</p>

                <pre><code class="language-text">OpenKitx403 Challenge

domain: https://api.example.com
server: api-v1
nonce: E2o6p0q0Zl5PBjXc
ts: 2025-11-05T10:30:00Z
method: GET
path: /protected

payload: {"alg":"ed25519-solana","aud":"https://api.example.com",...}</code></pre>

                <p>This string is signed with Ed25519 using the wallet's private key.</p>

                <h3 id="spec-verification">Verification Algorithm</h3>
                <p>The server verifies requests in 15 steps:</p>

                <ol>
                    <li>Parse Authorization header</li>
                    <li>Decode challenge from base64url</li>
                    <li>Validate protocol version (v == 1)</li>
                    <li>Validate algorithm (alg == "ed25519-solana")</li>
                    <li>Check challenge not expired (current_time &lt; exp)</li>
                    <li>Validate audience matches</li>
                    <li>Validate server ID matches</li>
                    <li>Check timestamp within clock skew (¬±120s default)</li>
                    <li>Verify method/path binding if enabled</li>
                    <li>Verify origin binding if enabled</li>
                    <li>Verify UA binding if enabled</li>
                    <li>Check nonce not reused (replay protection)</li>
                    <li>Verify Ed25519 signature</li>
                    <li>Check token gate if configured</li>
                    <li>Success - attach user to request</li>
                </ol>

                <div class="alert alert-info">
                    <strong>üìñ Full Specification:</strong> See <code>docs/COMPLETE_SPECIFICATION.md</code> in the source package for the complete RFC-style protocol specification.
                </div>
            </section>

            <!-- LangChain & AI Agents Section -->
            <section id="langchain" class="doc-section">
                <h2>LangChain & AI Agents</h2>
                <p>OpenKitx403 supports autonomous agents and LangChain tools for wallet authentication.</p>

                <h3>LangChain Tool</h3>
                <pre><code class="language-typescript">import { OpenKit403Client } from '@openkitx403/client';
import { Tool } from 'langchain/tools';

export class SolanaWalletAuthTool extends Tool {
  name = "solana_wallet_auth";
  description = "Authenticate with Solana wallet to access protected APIs";
  
  private client: OpenKit403Client;
  
  constructor() {
    super();
    this.client = new OpenKit403Client();
  }
  
  async _call(input: string): Promise<string> {
    const params = Object.fromEntries(
      input.split(',').map(p => p.split('='))
    );
    
    await this.client.connect(params.wallet as any);
    
    const result = await this.client.authenticate({
      resource: params.url,
      method: params.method || 'GET'
    });
    
    if (result.ok) {
      const data = await result.response?.json();
      return JSON.stringify({ success: true, data });
    }
    
    return JSON.stringify({ success: false, error: result.error });
  }
}</code></pre>

                <h3>Usage with LangChain Agent</h3>
                <pre><code class="language-typescript">import { initializeAgentExecutorWithOptions } from 'langchain/agents';
import { ChatOpenAI } from 'langchain/chat_models/openai';

const tools = [new SolanaWalletAuthTool()];
const model = new ChatOpenAI({ temperature: 0 });

const executor = await initializeAgentExecutorWithOptions(tools, model, {
  agentType: "zero-shot-react-description",
  verbose: true,
});

const result = await executor.call({
  input: "Connect my Phantom wallet and fetch my NFT collection"
});

console.log(result.output);</code></pre>

                <h3>Autonomous Agent</h3>
                <pre><code class="language-typescript">class WalletAuthAgent {
  private client: OpenKit403Client;
  
  constructor() {
    this.client = new OpenKit403Client();
  }
  
  async executeTask(task: {
    action: 'authenticate' | 'fetch' | 'post';
    url: string;
    wallet?: string;
    data?: any;
  }) {
    if (!this.client) {
      await this.client.connect((task.wallet || 'phantom') as any);
    }
    
    const result = await this.client.authenticate({
      resource: task.url,
      method: task.action === 'post' ? 'POST' : 'GET',
      body: task.data
    });
    
    return {
      success: result.ok,
      address: result.address,
      data: result.ok ? await result.response?.json() : null
    };
  }
}

// Usage
const agent = new WalletAuthAgent();

await agent.executeTask({
  action: 'authenticate',
  url: 'https://api.example.com/auth',
  wallet: 'phantom'
});

await agent.executeTask({
  action: 'fetch',
  url: 'https://api.example.com/nfts'
});

await agent.executeTask({
  action: 'post',
  url: 'https://api.example.com/trade',
  data: { action: 'buy', amount: 100 }
});</code></pre>
            </section>

            <!-- Security Section -->
            <section id="security" class="doc-section">
                <h2>Security</h2>

                <h3>Security Features</h3>
                <ul class="feature-list">
                    <li><strong>Ed25519 Signatures:</strong> Industry-standard cryptographic verification</li>
                    <li><strong>Replay Protection:</strong> Nonce-based prevention with configurable store</li>
                    <li><strong>Short TTL:</strong> Challenges expire in 60 seconds by default</li>
                    <li><strong>Method/Path Binding:</strong> Prevents cross-endpoint replay attacks</li>
                    <li><strong>Origin Binding:</strong> CORS protection (optional)</li>
                    <li><strong>Clock Skew Tolerance:</strong> ¬±120 seconds to handle time drift</li>
                    <li><strong>Token Gating:</strong> Verify NFT/token ownership before access</li>
                </ul>

                <h3>Best Practices</h3>
                <ul>
                    <li>‚úÖ <strong>Always use HTTPS</strong> in production</li>
                    <li>‚úÖ <strong>Enable replay protection</strong> with replay store</li>
                    <li>‚úÖ <strong>Use method/path binding</strong> for sensitive operations</li>
                    <li>‚úÖ <strong>Set appropriate TTL</strong> (60s recommended)</li>
                    <li>‚úÖ <strong>Implement rate limiting</strong> to prevent abuse</li>
                    <li>‚úÖ <strong>Monitor for anomalies</strong> (unusual patterns, IPs)</li>
                    <li>‚úÖ <strong>Keep dependencies updated</strong></li>
                </ul>

                <h3>Threats Mitigated</h3>
                <ul>
                    <li>‚úÖ Replay attacks (nonce + TTL + replay store)</li>
                    <li>‚úÖ Cross-endpoint replay (method/path binding)</li>
                    <li>‚úÖ Cross-origin replay (origin binding)</li>
                    <li>‚úÖ Clock skew attacks (timestamp validation)</li>
                    <li>‚úÖ Unsigned requests (signature verification)</li>
                </ul>

                <h3>Limitations</h3>
                <ul>
                    <li>‚ùå Does not protect against compromised wallets</li>
                    <li>‚ùå Does not prevent phishing attacks</li>
                    <li>‚ùå Requires user approval for each signature</li>
                </ul>

                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Security Notice:</strong> OpenKitx403 is for <strong>authentication</strong>, not message-level encryption. Always use HTTPS in production.
                </div>
            </section>

            <!-- Examples Section -->
            <section id="examples" class="doc-section">
                <h2>Complete Examples</h2>

                <h3>Browser + Express Full Stack</h3>
                
                <h4>Frontend (React)</h4>
                <pre><code class="language-typescript">import { useState } from 'react';
import { OpenKit403Client } from '@openkitx403/client';

function App() {
  const [client] = useState(() => new OpenKit403Client());
  const [address, setAddress] = useState<string>();
  const [profile, setProfile] = useState<any>();

  const login = async () => {
    await client.connect('phantom');
    
    const result = await client.authenticate({
      resource: 'http://localhost:3000/api/profile',
      method: 'GET'
    });
    
    if (result.ok) {
      setAddress(result.address);
      const data = await result.response?.json();
      setProfile(data);
    }
  };

  return (
    <div>
      {!address ? (
        <button onClick={login}>Connect Wallet</button>
      ) : (
        <div>
          <p>Wallet: {address}</p>
          <pre>{JSON.stringify(profile, null, 2)}</pre>
        </div>
      )}
    </div>
  );
}</code></pre>

                <h4>Backend (Express)</h4>
                <pre><code class="language-typescript">import express from 'express';
import cors from 'cors';
import { createOpenKit403, inMemoryLRU } from '@openkitx403/server';

const app = express();
app.use(cors());

const openkit = createOpenKit403({
  issuer: 'my-app',
  audience: 'http://localhost:3000',
  ttlSeconds: 60,
  replayStore: inMemoryLRU()
});

app.use('/api', openkit.middleware());

app.get('/api/profile', (req, res) => {
  const user = req.openkitx403User;
  res.json({
    address: user.address,
    username: `User_${user.address.slice(0, 6)}`,
    nftCount: 5,
    joinedAt: new Date().toISOString()
  });
});

app.listen(3000);</code></pre>

                <h3>FastAPI + Python Client</h3>

                <h4>Server (FastAPI)</h4>
                <pre><code class="language-python">from fastapi import FastAPI, Depends
from fastapi.middleware.cors import CORSMiddleware
from openkitx403 import OpenKit403Middleware, require_openkitx403_user

app = FastAPI()

app.add_middleware(CORSMiddleware, allow_origins=["*"])
app.add_middleware(
    OpenKit403Middleware,
    audience="http://localhost:8000",
    issuer="my-api",
    ttl_seconds=60
)

@app.get("/protected")
async def protected(user = Depends(require_openkitx403_user)):
    return {
        "address": user.address,
        "message": f"Hello, {user.address[:6]}!"
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)</code></pre>

                <h4>Client (Python)</h4>
                <pre><code class="language-python">import requests
from solana.keypair import Keypair
import base58

keypair = Keypair.generate()

# 1. Get challenge
response = requests.get("http://localhost:8000/protected")

if response.status_code == 403:
    www_auth = response.headers.get('WWW-Authenticate')
    challenge_b64 = re.search(r'challenge="([^"]+)"', www_auth).group(1)
    
    # 2. Sign challenge (implementation details omitted for brevity)
    signature = sign_challenge(challenge_b64, keypair)
    
    # 3. Retry with auth
    auth_header = build_auth_header(keypair.public_key, signature, challenge_b64)
    response = requests.get(
        "http://localhost:8000/protected",
        headers={'Authorization': auth_header}
    )
    
    print(response.json())</code></pre>

                <div class="alert alert-info">
                    <strong>üìñ More Examples:</strong> See <code>USAGE_EXAMPLES.md</code> in the source package for 8 complete sections of examples including Node.js, Fastify, and agent patterns.
                </div>
            </section>

            <!-- API Reference Section -->
            <section id="api-reference" class="doc-section">
                <h2>API Reference</h2>

                <h3>TypeScript Client</h3>

                <div class="api-method">
                    <h4><code>OpenKit403Client</code></h4>
                    
                    <h5>Constructor</h5>
                    <pre><code class="language-typescript">new OpenKit403Client(opts?: { wallet?: WalletProvider })</code></pre>
                    
                    <h5>Methods</h5>
                    
                    <div class="method-detail">
                        <code>connect(wallet: WalletProvider): Promise&lt;void&gt;</code>
                        <p>Connect to a Solana wallet (phantom, backpack, or solflare).</p>
                    </div>

                    <div class="method-detail">
                        <code>authenticate(options: AuthOptions): Promise&lt;AuthResult&gt;</code>
                        <p>Authenticate with a protected resource. Handles complete 403 flow.</p>
                        <ul>
                            <li><strong>options.resource:</strong> API endpoint URL</li>
                            <li><strong>options.method:</strong> HTTP method (default: 'GET')</li>
                            <li><strong>options.headers:</strong> Additional headers</li>
                            <li><strong>options.body:</strong> Request body for POST/PUT</li>
                        </ul>
                    </div>

                    <div class="method-detail">
                        <code>signChallenge(challengeB64: string): Promise&lt;{signature: string, address: string}&gt;</code>
                        <p>Sign a challenge with the connected wallet.</p>
                    </div>
                </div>

                <h3>TypeScript Server</h3>

                <div class="api-method">
                    <h4><code>createOpenKit403(config: OpenKit403Config)</code></h4>
                    
                    <h5>Configuration</h5>
                    <pre><code class="language-typescript">interface OpenKit403Config {
  issuer: string;                              // Server identifier
  audience: string;                            // Expected origin URL
  ttlSeconds?: number;                         // Challenge TTL (default: 60)
  bindMethodPath?: boolean;                    // Enable method/path binding
  originBinding?: boolean;                     // Enable origin verification
  uaBinding?: boolean;                         // Enable UA verification
  replayStore?: ReplayStore;                   // Nonce store for replay protection
  tokenGate?: (address: string) => Promise<boolean>;  // Token gating function
  clockSkewSeconds?: number;                   // Clock skew tolerance (default: 120)
}</code></pre>

                    <h5>Returns</h5>
                    <pre><code class="language-typescript">{
  createChallenge: (method: string, path: string) => { headerValue: string, challengeJson: Challenge },
  verifyAuthorization: (authHeader: string, method: string, path: string) => Promise<VerifyResult>,
  middleware: () => ExpressMiddleware,
  fastifyHook: () => FastifyHook
}</code></pre>
                </div>

                <div class="api-method">
                    <h4><code>inMemoryLRU(): ReplayStore</code></h4>
                    <p>Create an in-memory replay store with LRU eviction.</p>
                </div>

                <h3>Python Server</h3>

                <div class="api-method">
                    <h4><code>OpenKit403Middleware</code></h4>
                    
                    <h5>Configuration</h5>
                    <pre><code class="language-python">OpenKit403Middleware(
    audience: str,                    # Expected origin URL
    issuer: str,                      # Server identifier
    ttl_seconds: int = 60,           # Challenge TTL
    clock_skew_seconds: int = 120,   # Clock skew tolerance
    bind_method_path: bool = False,  # Enable method/path binding
    origin_binding: bool = False,    # Enable origin verification
    ua_binding: bool = False,        # Enable UA verification
    replay_backend: str = "memory",  # Replay store backend
    token_gate: Optional[Callable[[str], bool]] = None,  # Token gate function
    excluded_paths: Optional[List[str]] = None  # Paths to exclude from auth
)</code></pre>
                </div>

                <div class="api-method">
                    <h4><code>require_openkitx403_user</code></h4>
                    <p>FastAPI dependency that extracts authenticated user from request.</p>
                    <pre><code class="language-python">@app.get("/protected")
async def protected(user: OpenKit403User = Depends(require_openkitx403_user)):
    return {"address": user.address}</code></pre>
                </div>

                <div class="api-method">
                    <h4><code>OpenKit403User</code></h4>
                    <p>Authenticated user type.</p>
                    <pre><code class="language-python">class OpenKit403User:
    address: str           # Base58-encoded Solana public key
    challenge: Optional[Dict[str, Any]]  # Original challenge data</code></pre>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>OpenKitx403</h4>
                    <p>HTTP-native wallet authentication for Solana</p>
                    <p class="footer-license">MIT License ‚Ä¢ v0.1.0 ‚Ä¢ Production Ready</p>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="https://github.com/openkitx403/openkitx403">GitHub</a></li>
                        <li><a href="#protocol-spec">Protocol Spec</a></li>
                        <li><a href="#examples">Examples</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Packages</h4>
                    <ul>
                        <li><code>@openkitx403/client</code></li>
                        <li><code>@openkitx403/server</code></li>
                        <li><code>openkitx403</code> (Python)</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Built with ‚ù§Ô∏è for the Solana ecosystem</p>
            </div>
        </div>
    </footer>

    <script src="js/prism.js"></script>
    <script src="js/main.js"></script>
</body>
</html>


