<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenKitx403 - HTTP-Native Wallet Authentication for Solana</title>
    <meta name="description" content="Production-ready HTTP-native wallet authentication protocol for Solana with AI Agent & LangChain support. No custom protocols. No account secrets.">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/prism.css">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle navigation menu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>OpenKitx403</h1>
                    <span class="protocol-status">PROTOCOL ACTIVE</span>
                </div>
                <nav class="header-nav">
                    <a href="https://github.com/openkitx403/openkitx403" target="_blank" rel="noopener">GitHub</a>
                    <a href="#overview">Docs</a>
                    <a href="#ai-agents">Agents</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container main-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-sticky">
                <div class="toc-header">Table of Contents</div>
                <nav class="toc">
                    <ul>
                        <li><a href="#overview" class="active">Overview</a></li>
                        <li><a href="#how-it-works">How It Works</a></li>
                        <li><a href="#quick-start">Quick Start</a></li>
                        <li>
                            <a href="#installation">Installation</a>
                            <ul>
                                <li><a href="#install-client">TypeScript Client</a></li>
                                <li><a href="#install-server">Python Server</a></li>
                                <li><a href="#install-agent">AI Agent</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#client-sdk">Client SDK</a>
                            <ul>
                                <li><a href="#client-connect">Connect Wallet</a></li>
                                <li><a href="#client-authenticate">Authenticate</a></li>
                                <li><a href="#client-sign">Sign Challenge</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#server-sdk">Server SDK</a>
                            <ul>
                                <li><a href="#server-fastapi">FastAPI Middleware</a></li>
                                <li><a href="#server-config">Configuration</a></li>
                                <li><a href="#server-dependencies">Dependencies</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#protocol-spec">Protocol Specification</a>
                            <ul>
                                <li><a href="#spec-headers">HTTP Headers</a></li>
                                <li><a href="#spec-challenge">Challenge Format</a></li>
                                <li><a href="#spec-signature">Signature Envelope</a></li>
                                <li><a href="#spec-verification">Verification</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#examples">Examples</a>
                            <ul>
                                <li><a href="#example-browser">Browser Example</a></li>
                                <li><a href="#example-nodejs">Node.js Example</a></li>
                                <li><a href="#example-api">API Demo</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#ai-agents">AI Agents & LangChain</a>
                            <ul>
                                <li><a href="#agent-installation">Installation</a></li>
                                <li><a href="#agent-quickstart">Quick Start</a></li>
                                <li><a href="#agent-wallets">Wallet Management</a></li>
                                <li><a href="#langchain-integration">LangChain</a></li>
                                <li><a href="#multi-agent">Multi-Agent</a></li>
                                <li><a href="#trading-agent">Trading Agent</a></li>
                                <li><a href="#agent-security">Agent Security</a></li>
                                <li><a href="#agent-monitoring">Monitoring</a></li>
                            </ul>
                        </li>
                        <li><a href="#security">Security</a></li>
                        <li><a href="#advanced">Advanced Topics</a></li>
                        <li><a href="#api-reference">API Reference</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Main Documentation Content -->
        <main class="content">
            <!-- Overview Section -->
            <section id="overview" class="doc-section">
                <h1>OpenKitx403</h1>
                <p class="subtitle">HTTP-native wallet authentication for Solana with AI Agent support</p>
                
                <div class="feature-highlight">
                    <p>HTTP-native wallet authentication for Solana. Uses HTTP 403 as the primitive. Wallets sign challenges. No custom protocols. No account secrets. Full AI Agent & LangChain support.</p>
                </div>

                <div class="badges">
                    <span class="badge">‚úì Open Source</span>
                    <span class="badge">‚úì MIT License</span>
                    <span class="badge">‚úì Production Ready</span>
                    <span class="badge">‚úì AI Agents</span>
                </div>

                <h2>Features</h2>
                <ul class="feature-list">
                    <li><strong>HTTP-Native:</strong> Standard 403/WWW-Authenticate flow, no custom protocols</li>
                    <li><strong>Stateless:</strong> No required server-side session storage</li>
                    <li><strong>Wallet-Centric:</strong> Direct integration with Phantom, Backpack, Solflare</li>
                    <li><strong>Secure:</strong> Ed25519 signatures, replay protection, request binding</li>
                    <li><strong>Extensible:</strong> Token-gating, scopes, custom authorization</li>
                    <li><strong>Developer-Friendly:</strong> Simple APIs, comprehensive documentation</li>
                    <li><strong>AI Agent Ready:</strong> Native support for autonomous agents, LangChain integration</li>
                </ul>

                <h2>Why OpenKitx403?</h2>
                <p>Traditional web authentication requires centralized identity providers, sessions, and cookies. OpenKitx403 leverages the cryptographic security of Solana wallets to provide decentralized, passwordless authentication using standard HTTP semantics. With native AI Agent support, autonomous systems can now manage their own wallets and interact with Solana-protected APIs.</p>
            </section>

            <!-- How It Works Section -->
            <section id="how-it-works" class="doc-section">
                <h2>How It Works</h2>
                <p>OpenKitx403 follows a simple challenge-response authentication flow that works for both users and AI agents:</p>

                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Client Request</h3>
                            <p>Client/Agent attempts to access a protected resource</p>
                            <code class="inline-code">GET /protected</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Server Challenge</h3>
                            <p>Server responds with 403 and a challenge</p>
                            <code class="inline-code">403 Forbidden + WWW-Authenticate</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Wallet Signature</h3>
                            <p>Wallet/Agent signs the challenge with Ed25519</p>
                            <code class="inline-code">signMessage(challenge)</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Authenticated Request</h3>
                            <p>Client/Agent retries with Authorization header</p>
                            <code class="inline-code">GET /protected + Authorization</code>
                        </div>
                    </div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h3>Success</h3>
                            <p>Server verifies signature and grants access</p>
                            <code class="inline-code">200 OK</code>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Start Section -->
            <section id="quick-start" class="doc-section">
                <h2>Quick Start</h2>
                
                <h3>1. Clone Repository</h3>
                <pre><code class="language-bash"># Clone the repository
git clone https://github.com/openkitx403/openkitx403.git
cd openkitx403

# Install dependencies
npm install

# Build all packages
npm run build</code></pre>

                <h3>2. Run the Demo</h3>
                <pre><code class="language-bash"># Start the FastAPI server
cd packages/examples/api-demo
pip install -r requirements.txt
python main.py

# Server runs on http://localhost:8000</code></pre>

                <h3>3. Run AI Agent Demo</h3>
                <pre><code class="language-bash"># Create an AI agent and make authenticated requests
cd packages/examples/ai-agent-demo
pip install openkitx403[agent]
python agent_example.py</code></pre>

                <h3>4. Test the API</h3>
                <pre><code class="language-bash"># Try protected endpoint (will get 403 + challenge)
curl -i http://localhost:8000/protected

# Expected response:
# HTTP/1.1 403 Forbidden
# WWW-Authenticate: OpenKitx403 realm="api", version="1", challenge="..."</code></pre>
            </section>

            <!-- Installation Section -->
            <section id="installation" class="doc-section">
                <h2>Installation</h2>

                <div id="install-client" class="subsection">
                    <h3>TypeScript Client SDK</h3>
                    <p>For browser and Node.js applications:</p>
                    <pre><code class="language-bash">npm install @openkitx403/client</code></pre>
                    
                    <p>Or with yarn:</p>
                    <pre><code class="language-bash">yarn add @openkitx403/client</code></pre>
                </div>

                <div id="install-server" class="subsection">
                    <h3>Python Server SDK</h3>
                    <p>For FastAPI applications:</p>
                    <pre><code class="language-bash">pip install openkitx403</code></pre>
                    
                    <p>Or with Poetry:</p>
                    <pre><code class="language-bash">poetry add openkitx403</code></pre>
                </div>

                <div id="install-agent" class="subsection">
                    <h3>AI Agent SDK</h3>
                    <p>For autonomous agents and LangChain integration:</p>
                    <pre><code class="language-bash"># TypeScript
npm install @openkitx403/agent

# Python with LangChain
pip install openkitx403[agent,langchain]</code></pre>
                </div>
            </section>

            <!-- Client SDK Section -->
            <section id="client-sdk" class="doc-section">
                <h2>Client SDK (TypeScript)</h2>
                <p>The TypeScript client SDK provides a simple API for integrating wallet authentication in your web or Node.js application.</p>

                <div id="client-connect" class="subsection">
                    <h3>Connect to Wallet</h3>
                    <pre><code class="language-typescript">import { OpenKit403Client } from '@openkitx403/client';

// Create client instance
const client = new OpenKit403Client();

// Connect to Phantom wallet
await client.connect('phantom');

// Or connect to other wallets
await client.connect('backpack');
await client.connect('solflare');

// Check connection status
const isConnected = client.isConnected();
const address = client.getAddress();

console.log(`Connected: ${isConnected}`);
console.log(`Address: ${address}`);</code></pre>
                </div>

                <div id="client-authenticate" class="subsection">
                    <h3>Authenticate Against API</h3>
                    <p>The <code>authenticate()</code> method handles the complete flow automatically:</p>
                    <pre><code class="language-typescript">const result = await client.authenticate({
  resource: 'https://api.example.com/protected',
  method: 'GET',
  wallet: 'phantom' // Optional if already connected
});

if (result.ok) {
  console.log('Authenticated as:', result.address);
  const data = await result.response.json();
  console.log('Protected data:', data);
} else {
  console.error('Authentication failed:', result.error);
}</code></pre>
                </div>

                <div id="client-sign" class="subsection">
                    <h3>Manual Challenge Signing</h3>
                    <p>For advanced use cases, sign challenges manually:</p>
                    <pre><code class="language-typescript">// Get challenge from server's WWW-Authenticate header
const challengeBase64url = "eyJ2IjoxLCJhbGciOiJlZDI1NTE5LXNvbGFuYSIsLi4ufQ";

// Sign the challenge
const { signature, address } = await client.signChallenge(challengeBase64url);

console.log('Signature:', signature);
console.log('Address:', address);</code></pre>
                </div>
            </section>

            <!-- Server SDK Section -->
            <section id="server-sdk" class="doc-section">
                <h2>Server SDK (Python)</h2>
                <p>The Python server SDK provides FastAPI middleware for protecting your API endpoints with wallet authentication.</p>

                <div id="server-fastapi" class="subsection">
                    <h3>FastAPI Middleware Setup</h3>
                    <pre><code class="language-python">from fastapi import FastAPI, Depends
from openkitx403 import OpenKit403Middleware, require_openkitx403_user, User

app = FastAPI()

# Add OpenKitx403 middleware
app.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",
    issuer="my-api-v1",
    ttl_seconds=60,
    bind_method_path=True,
    origin_binding=False,
    clock_skew_seconds=120,
)

@app.get("/")
async def root():
    return {"message": "Public endpoint"}

@app.get("/protected")
async def protected(user: User = Depends(require_openkitx403_user)):
    return {
        "message": f"Hello, {user.address}!",
        "address": user.address,
        "authenticated": True
    }</code></pre>
                </div>

                <div id="server-config" class="subsection">
                    <h3>Configuration Options</h3>
                    <div class="table-responsive">
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>audience</code></td>
                                    <td>str</td>
                                    <td>‚úì</td>
                                    <td>Your API's base URL</td>
                                </tr>
                                <tr>
                                    <td><code>issuer</code></td>
                                    <td>str</td>
                                    <td>‚úì</td>
                                    <td>Server identifier for challenges</td>
                                </tr>
                                <tr>
                                    <td><code>ttl_seconds</code></td>
                                    <td>int</td>
                                    <td></td>
                                    <td>Challenge lifetime (default: 60)</td>
                                </tr>
                                <tr>
                                    <td><code>bind_method_path</code></td>
                                    <td>bool</td>
                                    <td></td>
                                    <td>Bind signature to method+path (default: True)</td>
                                </tr>
                                <tr>
                                    <td><code>origin_binding</code></td>
                                    <td>bool</td>
                                    <td></td>
                                    <td>Validate Origin header (default: False)</td>
                                </tr>
                                <tr>
                                    <td><code>clock_skew_seconds</code></td>
                                    <td>int</td>
                                    <td></td>
                                    <td>Allowed time skew (default: 120)</td>
                                </tr>
                                <tr>
                                    <td><code>replay_backend</code></td>
                                    <td>str</td>
                                    <td></td>
                                    <td>Nonce storage: "memory" or custom (default: "memory")</td>
                                </tr>
                                <tr>
                                    <td><code>realm</code></td>
                                    <td>str</td>
                                    <td></td>
                                    <td>WWW-Authenticate realm (default: "protected")</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="server-dependencies" class="subsection">
                    <h3>Using FastAPI Dependencies</h3>
                    <p>Protect specific endpoints with dependency injection:</p>
                    <pre><code class="language-python">from openkitx403 import require_openkitx403_user, User

@app.get("/api/profile")
async def get_profile(user: User = Depends(require_openkitx403_user)):
    # User is authenticated, address available in user.address
    return {
        "address": user.address,
        "badges": ["early-adopter", "verified"],
        "memberSince": "2024-03-15"
    }

@app.post("/api/action")
async def perform_action(user: User = Depends(require_openkitx403_user)):
    # Only authenticated users can perform this action
    return {
        "status": "success",
        "message": f"Action performed by {user.address}"
    }</code></pre>
                </div>
            </section>

            <!-- Protocol Specification Section -->
            <section id="protocol-spec" class="doc-section">
                <h2>Protocol Specification</h2>
                <p>OpenKitx403 uses standard HTTP authentication mechanisms with a custom challenge-response protocol.</p>

                <div id="spec-headers" class="subsection">
                    <h3>HTTP Headers</h3>
                    
                    <h4>WWW-Authenticate (Server ‚Üí Client)</h4>
                    <p>When a protected resource is accessed without authentication:</p>
                    <pre><code class="language-http">HTTP/1.1 403 Forbidden
WWW-Authenticate: OpenKitx403 realm="api", version="1", challenge="eyJ2IjoxLC..."
Content-Type: application/json

{
  "error": "wallet_auth_required",
  "detail": "Sign the challenge using your Solana wallet"
}</code></pre>

                    <h4>Authorization (Client ‚Üí Server)</h4>
                    <p>After signing the challenge, client includes:</p>
                    <pre><code class="language-http">GET /protected HTTP/1.1
Host: api.example.com
Authorization: OpenKitx403 addr="8xQ7Ks9pZ...", sig="2Ks9pZ2FjXc...", challenge="eyJ2IjoxLC...", ts="2025-10-30T16:30:15Z", nonce="vN8xM2pQ7rS9tU3wV5yZ", bind="GET:/protected"</code></pre>
                </div>

                <div id="spec-challenge" class="subsection">
                    <h3>Challenge Format</h3>
                    <p>The challenge is a base64url-encoded JSON object:</p>
                    <pre><code class="language-json">{
  "v": 1,
  "alg": "ed25519-solana",
  "nonce": "E2o6p0q0Zl5PBjXc",
  "ts": "2025-10-30T16:30:00Z",
  "aud": "https://api.example.com",
  "method": "GET",
  "path": "/protected",
  "serverId": "api-example-v1",
  "exp": "2025-10-30T16:31:00Z",
  "originBind": false,
  "uaBind": false
}</code></pre>

                    <div class="table-responsive">
                        <table class="config-table">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>v</code></td>
                                    <td>integer</td>
                                    <td>Protocol version (must be 1)</td>
                                </tr>
                                <tr>
                                    <td><code>alg</code></td>
                                    <td>string</td>
                                    <td>Signature algorithm ("ed25519-solana")</td>
                                </tr>
                                <tr>
                                    <td><code>nonce</code></td>
                                    <td>string</td>
                                    <td>Random nonce (‚â•96 bits entropy)</td>
                                </tr>
                                <tr>
                                    <td><code>ts</code></td>
                                    <td>string</td>
                                    <td>Challenge timestamp (RFC 3339)</td>
                                </tr>
                                <tr>
                                    <td><code>aud</code></td>
                                    <td>string</td>
                                    <td>Intended audience (API URL)</td>
                                </tr>
                                <tr>
                                    <td><code>method</code></td>
                                    <td>string</td>
                                    <td>HTTP method for binding</td>
                                </tr>
                                <tr>
                                    <td><code>path</code></td>
                                    <td>string</td>
                                    <td>Request path for binding</td>
                                </tr>
                                <tr>
                                    <td><code>serverId</code></td>
                                    <td>string</td>
                                    <td>Server identifier</td>
                                </tr>
                                <tr>
                                    <td><code>exp</code></td>
                                    <td>string</td>
                                    <td>Expiration timestamp (RFC 3339)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="spec-signature" class="subsection">
                    <h3>Signature Envelope</h3>
                    <p>Wallets sign a canonical envelope format to prevent signature oracle attacks:</p>
                    <pre><code class="language-plaintext">OpenKitx403 Challenge

domain: https://api.example.com
server: api-example-v1
nonce: E2o6p0q0Zl5PBjXc
ts: 2025-10-30T16:30:00Z
method: GET
path: /protected

payload: {"v":1,"alg":"ed25519-solana",...}</code></pre>

                    <p>This envelope provides:</p>
                    <ul>
                        <li>Clear human-readable context for wallet UIs</li>
                        <li>Canonical format preventing signature malleability</li>
                        <li>Full challenge data for verification</li>
                    </ul>
                </div>

                <div id="spec-verification" class="subsection">
                    <h3>Server Verification Steps</h3>
                    <ol>
                        <li><strong>Parse Authorization:</strong> Extract addr, sig, challenge, ts, nonce, bind</li>
                        <li><strong>Decode Challenge:</strong> Base64url decode and parse JSON</li>
                        <li><strong>Validate Challenge:</strong> Check version, algorithm, audience, expiration</li>
                        <li><strong>Check Replay:</strong> Verify nonce not used before (if stateful mode)</li>
                        <li><strong>Validate Binding:</strong> Verify method, path, origin match</li>
                        <li><strong>Reconstruct Envelope:</strong> Build canonical envelope from challenge</li>
                        <li><strong>Verify Signature:</strong> Ed25519 verify using provided address</li>
                        <li><strong>Success:</strong> Extract address as authenticated user</li>
                    </ol>
                </div>
            </section>

            <!-- Examples Section -->
            <section id="examples" class="doc-section">
                <h2>Examples</h2>

                <div id="example-browser" class="subsection">
                    <h3>Browser Example</h3>
                    <p>Complete browser implementation with Phantom wallet:</p>
                    <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;OpenKitx403 Browser Demo&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;button id="connectBtn"&gt;Connect Wallet&lt;/button&gt;
    &lt;button id="fetchBtn" disabled&gt;Fetch Protected Data&lt;/button&gt;
    &lt;pre id="output"&gt;&lt;/pre&gt;

    &lt;script type="module"&gt;
        import { OpenKit403Client } from '@openkitx403/client';

        const client = new OpenKit403Client();
        const connectBtn = document.getElementById('connectBtn');
        const fetchBtn = document.getElementById('fetchBtn');
        const output = document.getElementById('output');

        connectBtn.onclick = async () => {
            try {
                await client.connect('phantom');
                output.textContent = `Connected: ${client.getAddress()}`;
                connectBtn.disabled = true;
                fetchBtn.disabled = false;
            } catch (err) {
                output.textContent = `Error: ${err.message}`;
            }
        };

        fetchBtn.onclick = async () => {
            try {
                const result = await client.authenticate({
                    resource: 'http://localhost:8000/protected',
                    method: 'GET'
                });

                if (result.ok) {
                    const data = await result.response.json();
                    output.textContent = JSON.stringify(data, null, 2);
                } else {
                    output.textContent = `Error: ${result.error}`;
                }
            } catch (err) {
                output.textContent = `Error: ${err.message}`;
            }
        };
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                </div>

                <div id="example-nodejs" class="subsection">
                    <h3>Node.js Example</h3>
                    <p>Server-side authentication with keypair:</p>
                    <pre><code class="language-typescript">import { OpenKit403Client } from '@openkitx403/client';
import { Keypair } from '@solana/web3.js';
import fetch from 'node-fetch';

// Load or generate keypair
const keypair = Keypair.generate();

// Custom Node.js wallet adapter
class NodeWalletAdapter {
    async connect() { return keypair.publicKey; }
    async disconnect() {}
    isConnected() { return true; }
    getAddress() { return keypair.publicKey.toBase58(); }
    async signMessage(message: Uint8Array) {
        return keypair.sign(message);
    }
}

const client = new OpenKit403Client({ 
    wallet: new NodeWalletAdapter() 
});

const result = await client.authenticate({
    resource: 'https://api.example.com/protected',
    method: 'GET'
});

console.log('Result:', await result.response.json());</code></pre>
                </div>

                <div id="example-api" class="subsection">
                    <h3>Complete API Demo</h3>
                    <p>Full FastAPI application with multiple protected endpoints:</p>
                    <pre><code class="language-python">from fastapi import FastAPI, Depends
from fastapi.middleware.cors import CORSMiddleware
from openkitx403 import OpenKit403Middleware, require_openkitx403_user, User

app = FastAPI(title="OpenKitx403 API Demo")

# Enable CORS for browser clients
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Add OpenKitx403 middleware
app.add_middleware(
    OpenKit403Middleware,
    audience="http://localhost:8000",
    issuer="api-demo-v1",
    ttl_seconds=60,
    bind_method_path=True,
)

@app.get("/")
async def root():
    return {"message": "OpenKitx403 API Demo", "version": "0.1.0"}

@app.get("/public")
async def public():
    return {"message": "This endpoint is public"}

@app.get("/protected")
async def protected(user: User = Depends(require_openkitx403_user)):
    return {
        "message": f"Hello, wallet {user.address}!",
        "address": user.address,
        "authenticated": True
    }

@app.get("/api/profile")
async def profile(user: User = Depends(require_openkitx403_user)):
    return {
        "address": user.address,
        "badges": ["early-adopter", "verified"],
        "memberSince": "2024-03-15"
    }

@app.post("/api/action")
async def action(user: User = Depends(require_openkitx403_user)):
    return {
        "status": "success",
        "message": f"Action performed by {user.address}"
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)</code></pre>
                </div>
            </section>

            <!-- AI Agent & LangChain Integration Section -->
            <section id="ai-agents" class="doc-section">
                <h2>AI Agents & LangChain Integration</h2>
                <p>OpenKitx403 provides native support for AI agents and LangChain, enabling autonomous systems to authenticate with Solana wallets and interact with protected APIs without user intervention.</p>

                <div class="feature-highlight">
                    <p>ü§ñ Create autonomous agents that manage their own wallets, authenticate API requests, coordinate with other agents, and integrate with LangChain for LLM-powered automation.</p>
                </div>

                <h3>Use Cases</h3>
                <ul>
                    <li><strong>DeFi Trading Bots:</strong> Automated market making, arbitrage, portfolio management</li>
                    <li><strong>NFT Agents:</strong> Collection monitoring, automated bidding, rarity analysis</li>
                    <li><strong>DAO Governance:</strong> Proposal analysis, automated voting, treasury management</li>
                    <li><strong>Data Analysis:</strong> On-chain analytics, wallet tracking, risk assessment</li>
                </ul>

                <div id="agent-installation" class="subsection">
                    <h3>Installation</h3>
                    
                    <h4>TypeScript</h4>
                    <pre><code class="language-bash">npm install @openkitx403/agent
# or
yarn add @openkitx403/agent</code></pre>

                    <h4>Python</h4>
                    <pre><code class="language-bash">pip install openkitx403[agent]
# with LangChain support
pip install openkitx403[agent,langchain]</code></pre>
                </div>

                <div id="agent-quickstart" class="subsection">
                    <h3>Quick Start</h3>
                    
                    <h4>TypeScript Agent</h4>
                    <pre><code class="language-typescript">import { OpenKit403Agent } from '@openkitx403/agent';

// Create agent with auto-generated wallet
const agent = new OpenKit403Agent({ provider: 'local' });
console.log(`Agent wallet: ${agent.getAddress()}`);

// Make authenticated request
const response = await agent.authenticate({
  url: 'https://api.example.com/protected',
  method: 'GET'
});

if (response.ok) {
  console.log('‚úÖ Authenticated as:', response.address);
  console.log('Response:', response.data);
} else {
  console.error('‚ùå Failed:', response.error);
}</code></pre>

                    <h4>Python Agent</h4>
                    <pre><code class="language-python">from openkitx403.agent import OpenKit403Agent, AgentRequest

# Create agent with auto-generated wallet
agent = OpenKit403Agent()
print(f"Agent wallet: {agent.get_address()}")

# Make authenticated request
response = await agent.authenticate(
    AgentRequest(
        url="https://api.example.com/protected",
        method="GET"
    )
)

if response.ok:
    print(f"‚úÖ Success: {response.data}")
else:
    print(f"‚ùå Failed: {response.error}")</code></pre>
                </div>

                <div id="agent-wallets" class="subsection">
                    <h3>Wallet Management</h3>
                    
                    <h4>Generate New Wallet</h4>
                    <pre><code class="language-typescript">// TypeScript
const agent = new OpenKit403Agent({ provider: 'local' });
console.log('New wallet:', agent.getAddress());</code></pre>

                    <pre><code class="language-python"># Python
agent = OpenKit403Agent()
print(f"New wallet: {agent.get_address()}")</code></pre>

                    <h4>Import Existing Wallet</h4>
                    <pre><code class="language-typescript">// TypeScript
import { LocalAgentWallet } from '@openkitx403/agent';

const wallet = LocalAgentWallet.fromPrivateKey('YOUR_PRIVATE_KEY_BASE58');
const agent = new OpenKit403Agent({ wallet });
console.log('Imported wallet:', agent.getAddress());</code></pre>

                    <pre><code class="language-python"># Python
agent = OpenKit403Agent(private_key="YOUR_PRIVATE_KEY_BASE58")
print(f"Imported wallet: {agent.get_address()}")</code></pre>

                    <h4>Export Wallet</h4>
                    <pre><code class="language-typescript">// TypeScript
const privateKey = wallet.secretKey; // Uint8Array
const address = wallet.address; // Base58 string</code></pre>

                    <pre><code class="language-python"># Python
private_key = agent.wallet.export_private_key()  # Base58
address = agent.wallet.address  # Base58</code></pre>
                </div>

                <div id="langchain-integration" class="subsection">
                    <h3>LangChain Integration</h3>
                    <p>Integrate OpenKitx403 agents with LangChain to create LLM-powered agents that can authenticate with Solana wallets.</p>

                    <h4>TypeScript LangChain Tool</h4>
                    <pre><code class="language-typescript">import { 
  OpenKit403Tool, 
  OpenKit403Chain 
} from '@openkitx403/agent/langchain';

// Create agent
const agent = new OpenKit403Agent({ provider: 'local' });

// Create LangChain tool
const tool = new OpenKit403Tool({
  name: 'solana_api',
  description: 'Authenticate and query Solana APIs',
  agent
});

// Use the tool
const result = await tool.call({
  url: 'https://api.example.com/api/wallet/balance',
  method: 'GET'
});

console.log('Tool result:', JSON.parse(result));

// Create chain for session management
const chain = new OpenKit403Chain(agent, 'https://api.example.com');

// Make authenticated calls
const balance = await chain.invoke({
  endpoint: '/api/wallet/balance'
});

console.log('Balance:', balance);</code></pre>

                    <h4>Python LangChain Tool</h4>
                    <pre><code class="language-python">from langchain.agents import initialize_agent, AgentType
from langchain.llms import OpenAI
from openkitx403.agent import OpenKit403Tool

# Create agent and tool
kit_agent = OpenKit403Agent()
tool = OpenKit403Tool(kit_agent)

# Initialize LangChain agent
llm = OpenAI(temperature=0.7)
agent = initialize_agent(
    tools=[tool],
    llm=llm,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

# Use natural language to interact with APIs
response = agent.run(
    "Authenticate and fetch data from https://api.example.com/protected"
)

print(response)</code></pre>

                    <h4>Advanced: Custom Tool Factory</h4>
                    <pre><code class="language-typescript">import { OpenKit403ToolFactory } from '@openkitx403/agent';

// Create tools for specific API endpoints
const tools = OpenKit403ToolFactory.createAPITools(agent, {
  baseUrl: 'https://api.example.com',
  endpoints: [
    {
      path: '/api/wallet/balance',
      description: 'Get wallet balance',
      name: 'get_balance'
    },
    {
      path: '/api/wallet/nfts',
      description: 'Get NFT holdings',
      name: 'get_nfts'
    },
    {
      path: '/api/transaction',
      method: 'POST',
      description: 'Submit transaction',
      name: 'submit_tx'
    }
  ]
});

// Register with LangChain
tools.forEach(tool => {
  // Use with your LangChain agent
});</code></pre>
                </div>

                <div id="multi-agent" class="subsection">
                    <h3>Multi-Agent Coordination</h3>
                    <p>Coordinate multiple AI agents, each with their own wallet and identity:</p>

                    <h4>TypeScript Multi-Agent</h4>
                    <pre><code class="language-typescript">import { AgentWalletManager } from '@openkitx403/agent';

const manager = new AgentWalletManager();

// Create agents with different roles
manager.generateWallet('trader_1');
manager.generateWallet('trader_2');
manager.generateWallet('analyst');

console.log('Created agents:', manager.listWallets());

// Execute parallel requests with all agents
const request = {
  url: 'https://api.example.com/api/market/data',
  method: 'GET' as const
};

const results = await manager.authenticateAll(request);

results.forEach((response, agentId) => {
  const status = response.ok ? '‚úÖ' : '‚ùå';
  console.log(`${agentId}: ${status} (${response.status})`);
});</code></pre>

                    <h4>Python Multi-Agent</h4>
                    <pre><code class="language-python">from openkitx403.agent import AgentWalletManager, AgentRequest

class MultiAgentCoordinator:
    def __init__(self):
        self.manager = AgentWalletManager()
        self.agents = {}
    
    def create_agent(self, agent_id: str):
        wallet = self.manager.generate_wallet(agent_id)
        agent = OpenKit403Agent(
            private_key=wallet.export_private_key()
        )
        self.agents[agent_id] = agent
        return agent
    
    async def execute_parallel(self, api_base: str):
        tasks = []
        for agent_id, agent in self.agents.items():
            task = agent.authenticate(
                AgentRequest(
                    url=f"{api_base}/api/data",
                    method="GET"
                )
            )
            tasks.append((agent_id, task))
        
        results = {}
        for agent_id, task in tasks:
            result = await task
            results[agent_id] = result
        
        return results

# Usage
coordinator = MultiAgentCoordinator()
coordinator.create_agent("trader_1")
coordinator.create_agent("trader_2")
coordinator.create_agent("analyst")

results = await coordinator.execute_parallel("https://api.example.com")</code></pre>
                </div>

                <div id="trading-agent" class="subsection">
                    <h3>Trading Agent Example</h3>
                    <p>Complete example of an AI trading agent that can authenticate, analyze markets, and execute trades.</p>

                    <pre><code class="language-typescript">import { 
  OpenKit403Agent, 
  OpenKit403AgentExecutor,
  OpenKit403ToolFactory 
} from '@openkitx403/agent';

class TradingAgent {
  private agent: OpenKit403Agent;
  private executor: OpenKit403AgentExecutor;
  private baseUrl: string;
  
  constructor(privateKey?: string) {
    this.agent = new OpenKit403Agent({
      privateKey: privateKey,
      provider: privateKey ? undefined : 'local'
    });
    
    this.executor = new OpenKit403AgentExecutor(this.agent);
    this.baseUrl = 'https://api.trading-platform.com';
    
    this.setupTools();
  }
  
  private setupTools() {
    const tools = OpenKit403ToolFactory.createAPITools(this.agent, {
      baseUrl: this.baseUrl,
      endpoints: [
        {
          path: '/api/market/orderbook',
          name: 'get_orderbook',
          description: 'Get current order book'
        },
        {
          path: '/api/account/balance',
          name: 'get_balance',
          description: 'Get account balance'
        },
        {
          path: '/api/orders/place',
          method: 'POST',
          name: 'place_order',
          description: 'Place a trading order'
        }
      ]
    });
    
    tools.forEach(tool => this.executor.addTool(tool));
  }
  
  async analyzeMarket(): Promise<any> {
    console.log('üìä Analyzing market...');
    const orderbook = await this.executor.executeTool('get_orderbook', {});
    return this.processOrderbook(orderbook);
  }
  
  private processOrderbook(orderbook: any): any {
    return {
      spread: this.calculateSpread(orderbook),
      depth: this.calculateDepth(orderbook),
      trend: this.detectTrend(orderbook)
    };
  }
  
  private calculateSpread(orderbook: any): number {
    return 0.01;
  }
  
  private calculateDepth(orderbook: any): string {
    return 'high';
  }
  
  private detectTrend(orderbook: any): string {
    return 'bullish';
  }
  
  async executeTrade(
    action: 'buy' | 'sell', 
    amount: number, 
    price: number
  ): Promise<any> {
    console.log(`üìà Executing ${action} order: ${amount} @ ${price}`);
    
    const order = {
      body: {
        side: action,
        amount,
        price,
        type: 'limit'
      }
    };
    
    const result = await this.executor.executeTool('place_order', order);
    
    if (result.success) {
      console.log('‚úÖ Order placed:', result.data);
    } else {
      console.log('‚ùå Order failed:', result.error);
    }
    
    return result;
  }
  
  async getPortfolio(): Promise<any> {
    const balance = await this.executor.executeTool('get_balance', {});
    return {
      wallet: this.agent.getAddress(),
      balance
    };
  }
  
  getAddress(): string {
    return this.agent.getAddress() || 'Not connected';
  }
}

// Usage
async function main() {
  const trader = new TradingAgent();
  console.log('Trading agent wallet:', trader.getAddress());
  
  const analysis = await trader.analyzeMarket();
  console.log('Market analysis:', analysis);
  
  const portfolio = await trader.getPortfolio();
  console.log('Current portfolio:', portfolio);
  
  if (analysis.trend === 'bullish' && analysis.depth === 'high') {
    await trader.executeTrade('buy', 100, 50.25);
  }
}

main();</code></pre>

                    <h4>Python Trading Agent</h4>
                    <pre><code class="language-python">from openkitx403.agent import OpenKit403Agent, AgentRequest
from typing import Dict, Any

class TradingAgent:
    def __init__(self, private_key: str = None):
        self.agent = OpenKit403Agent(private_key=private_key)
        self.base_url = "https://api.trading-platform.com"
        self.history = []
    
    async def analyze_market(self) -> Dict[str, Any]:
        print("üìä Analyzing market...")
        response = await self.agent.authenticate(
            AgentRequest(
                url=f"{self.base_url}/api/market/orderbook",
                method="GET"
            )
        )
        
        if response.ok:
            return self.process_orderbook(response.data)
        else:
            raise Exception(f"Failed to get market data: {response.error}")
    
    def process_orderbook(self, orderbook: Dict) -> Dict:
        return {
            "spread": self.calculate_spread(orderbook),
            "depth": self.calculate_depth(orderbook),
            "trend": self.detect_trend(orderbook)
        }
    
    def calculate_spread(self, orderbook: Dict) -> float:
        return 0.01
    
    def calculate_depth(self, orderbook: Dict) -> str:
        return "high"
    
    def detect_trend(self, orderbook: Dict) -> str:
        return "bullish"
    
    async def execute_trade(
        self, 
        action: str, 
        amount: float, 
        price: float
    ) -> Dict[str, Any]:
        print(f"üìà Executing {action} order: {amount} @ {price}")
        
        response = await self.agent.authenticate(
            AgentRequest(
                url=f"{self.base_url}/api/orders/place",
                method="POST",
                body={
                    "side": action,
                    "amount": amount,
                    "price": price,
                    "type": "limit"
                }
            )
        )
        
        if response.ok:
            print(f"‚úÖ Order placed: {response.data}")
        else:
            print(f"‚ùå Order failed: {response.error}")
        
        return {"success": response.ok, "data": response.data}
    
    async def get_portfolio(self) -> Dict[str, Any]:
        response = await self.agent.authenticate(
            AgentRequest(
                url=f"{self.base_url}/api/account/balance",
                method="GET"
            )
        )
        
        return {
            "wallet": self.agent.get_address(),
            "balance": response.data if response.ok else None
        }
    
    def get_address(self) -> str:
        return self.agent.get_address()

# Usage
async def main():
    trader = TradingAgent()
    print(f"Trading agent wallet: {trader.get_address()}")
    
    analysis = await trader.analyze_market()
    print(f"Market analysis: {analysis}")
    
    portfolio = await trader.get_portfolio()
    print(f"Current portfolio: {portfolio}")
    
    if analysis["trend"] == "bullish":
        await trader.execute_trade("buy", 100, 50.25)

import asyncio
asyncio.run(main())</code></pre>
                </div>

                <div id="agent-security" class="subsection">
                    <h3>Security Considerations</h3>
                    
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Private Key Management</strong>
                        <p>Never hardcode private keys in source code. Use environment variables, secure key management systems, or hardware wallets for production agents.</p>
                    </div>

                    <h4>Best Practices</h4>
                    <ul>
                        <li><strong>Separate wallets</strong> for different agent roles and risk levels</li>
                        <li><strong>Environment variables</strong> for private keys: <code>process.env.AGENT_PRIVATE_KEY</code></li>
                        <li><strong>Rate limiting</strong> to prevent abuse and excessive API calls</li>
                        <li><strong>Spending limits</strong> for trading agents</li>
                        <li><strong>Test networks</strong> during development (devnet, testnet)</li>
                        <li><strong>Audit logging</strong> for all agent actions</li>
                        <li><strong>Regular key rotation</strong> for long-running agents</li>
                    </ul>

                    <h4>Secure Key Loading</h4>
                    <pre><code class="language-typescript">// TypeScript - Load from environment
const agent = new OpenKit403Agent({
  privateKey: process.env.AGENT_PRIVATE_KEY
});

// Or use a key management service
import { KMSKeyProvider } from './kms';
const wallet = await KMSKeyProvider.getWallet('agent-key-id');
const agent = new OpenKit403Agent({ wallet });</code></pre>

                    <pre><code class="language-python"># Python - Load from environment
import os
agent = OpenKit403Agent(
    private_key=os.getenv('AGENT_PRIVATE_KEY')
)

# Or use a secrets manager
from secrets_manager import get_private_key
agent = OpenKit403Agent(
    private_key=get_private_key('agent-key-id')
)</code></pre>
                </div>

                <div id="agent-monitoring" class="subsection">
                    <h3>Monitoring & Logging</h3>
                    <p>Track agent performance and activity:</p>

                    <pre><code class="language-typescript">import { OpenKit403Memory } from '@openkitx403/agent';

const memory = new OpenKit403Memory();

// Track requests
memory.addRequest(request, response);

// Get statistics
console.log(`Success rate: ${memory.getSuccessRate() * 100}%`);
console.log(memory.toString());

// Output:
// Authentication History (last 5 requests):
//   2025-11-04T10:30:00Z - GET https://api.example.com/data - ‚úì
//   2025-11-04T10:30:15Z - POST https://api.example.com/tx - ‚úì
//   2025-11-04T10:30:30Z - GET https://api.example.com/balance - ‚úì
//   Success rate: 100.0%</code></pre>

                    <pre><code class="language-python"># Python monitoring
class AgentMonitor:
    def __init__(self, agent):
        self.agent = agent
        self.requests = []
    
    async def monitored_request(self, request):
        import time
        from datetime import datetime
        start = time.time()
        response = await self.agent.authenticate(request)
        duration = time.time() - start
        
        self.requests.append({
            'timestamp': datetime.now(),
            'url': request.url,
            'success': response.ok,
            'duration': duration,
            'wallet': response.address
        })
        
        return response
    
    def get_metrics(self):
        total = len(self.requests)
        successful = sum(1 for r in self.requests if r['success'])
        avg_duration = sum(r['duration'] for r in self.requests) / total if total > 0 else 0
        
        return {
            'total_requests': total,
            'success_rate': successful / total if total > 0 else 0,
            'avg_response_time': avg_duration
        }</code></pre>
                </div>
            </section>

            <!-- Security Section -->
            <section id="security" class="doc-section">
                <h2>Security</h2>

                <h3>Security Model</h3>
                <p>OpenKitx403 provides multiple layers of security:</p>

                <h4>1. Cryptographic Security</h4>
                <ul>
                    <li><strong>Ed25519 Signatures:</strong> Industry-standard elliptic curve signatures</li>
                    <li><strong>Challenge Binding:</strong> Each signature is tied to specific request context</li>
                    <li><strong>Nonce Randomness:</strong> Cryptographically secure random nonces (‚â•96 bits)</li>
                </ul>

                <h4>2. Replay Protection</h4>
                <p>Two modes available:</p>
                <ul>
                    <li><strong>Stateless Mode:</strong> Short TTL + request binding + timestamp validation</li>
                    <li><strong>Stateful Mode:</strong> Nonce storage in Redis/memory, each nonce valid once</li>
                </ul>

                <h4>3. Request Binding</h4>
                <p>Signatures can be bound to:</p>
                <ul>
                    <li><strong>Method + Path:</strong> Prevents signature reuse on different endpoints</li>
                    <li><strong>Origin Header:</strong> Prevents cross-origin signature theft</li>
                    <li><strong>User-Agent:</strong> Additional client fingerprinting</li>
                </ul>

                <h4>4. Time-Based Validation</h4>
                <ul>
                    <li><strong>Challenge Expiration:</strong> Default 60-second TTL</li>
                    <li><strong>Clock Skew:</strong> ¬±120 seconds tolerance for time sync issues</li>
                    <li><strong>Timestamp Verification:</strong> Prevents replay of old challenges</li>
                </ul>

                <h3>Security Best Practices</h3>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è HTTPS Required</strong>
                    <p>Never use OpenKitx403 over plain HTTP in production. HTTPS is mandatory to prevent challenge interception and signature theft.</p>
                </div>

                <h4>Server Configuration</h4>
                <pre><code class="language-python"># Production configuration
app.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",  # Use HTTPS
    issuer="production-api-v1",
    ttl_seconds=60,                      # Keep TTL short
    bind_method_path=True,               # Enable request binding
    origin_binding=True,                 # Enable origin validation
    replay_backend="redis",              # Use Redis for nonce storage
    clock_skew_seconds=120,
)</code></pre>

                <h4>Client Implementation</h4>
                <ul>
                    <li>Always verify the challenge domain matches expected API</li>
                    <li>Show challenge details to users in wallet UI</li>
                    <li>Never cache signatures across different requests</li>
                    <li>Implement rate limiting for signature attempts</li>
                </ul>

                <h3>Threat Model</h3>
                <div class="table-responsive">
                    <table class="config-table">
                        <thead>
                            <tr>
                                <th>Attack Vector</th>
                                <th>Mitigation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Replay Attack</td>
                                <td>Nonce storage + TTL + timestamp validation</td>
                            </tr>
                            <tr>
                                <td>Signature Reuse</td>
                                <td>Request binding (method + path)</td>
                            </tr>
                            <tr>
                                <td>MITM Attack</td>
                                <td>HTTPS required, origin binding</td>
                            </tr>
                            <tr>
                                <td>Challenge Manipulation</td>
                                <td>Signature over canonical envelope</td>
                            </tr>
                            <tr>
                                <td>Time-Based Attack</td>
                                <td>Short TTL, clock skew limits</td>
                            </tr>
                            <tr>
                                <td>Phishing</td>
                                <td>Wallet UI shows challenge details</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>Reporting Security Issues</h3>
                <p>If you discover a security vulnerability, please email <strong>security@openkitx403.dev</strong>. Do not open public issues for security concerns.</p>
            </section>

            <!-- Advanced Topics Section -->
            <section id="advanced" class="doc-section">
                <h2>Advanced Topics</h2>

                <h3>Token-Gating</h3>
                <p>Restrict access based on token holdings:</p>
                <pre><code class="language-python">from openkitx403 import OpenKit403Middleware

# Custom verification with token-gating
async def verify_token_holdings(user: User):
    # Check if user holds required tokens
    balance = await get_token_balance(user.address, TOKEN_MINT)
    if balance < REQUIRED_AMOUNT:
        raise HTTPException(403, "Insufficient token balance")
    return user

@app.get("/exclusive")
async def exclusive(user: User = Depends(verify_token_holdings)):
    return {"message": "Welcome, token holder!"}</code></pre>

                <h3>Custom Nonce Storage</h3>
                <p>Implement custom nonce storage backends:</p>
                <pre><code class="language-python">import redis

class RedisNonceStore:
    def __init__(self, redis_url: str):
        self.redis = redis.from_url(redis_url)
    
    def exists(self, key: str) -> bool:
        return self.redis.exists(key)
    
    def set(self, key: str, value: str, ex: int):
        self.redis.setex(key, ex, value)

# Use custom store
nonce_store = RedisNonceStore("redis://localhost:6379")

app.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",
    issuer="api-v1",
    replay_backend=nonce_store,
)</code></pre>

                <h3>Rate Limiting</h3>
                <p>Add rate limiting to prevent abuse:</p>
                <pre><code class="language-python">from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@app.get("/protected")
@limiter.limit("10/minute")
async def protected(user: User = Depends(require_openkitx403_user)):
    return {"message": "Rate-limited endpoint"}</code></pre>

                <h3>Multi-Tenancy</h3>
                <p>Support multiple apps with different server IDs:</p>
                <pre><code class="language-python"># App 1
app1 = FastAPI()
app1.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",
    issuer="app1-v1",
)

# App 2
app2 = FastAPI()
app2.add_middleware(
    OpenKit403Middleware,
    audience="https://api.example.com",
    issuer="app2-v1",
)</code></pre>

                <h3>Custom Authorization Logic</h3>
                <p>Implement custom authorization rules:</p>
                <pre><code class="language-python">from fastapi import HTTPException

async def require_admin(user: User = Depends(require_openkitx403_user)):
    if user.address not in ADMIN_ADDRESSES:
        raise HTTPException(403, "Admin access required")
    return user

@app.delete("/api/resource/{id}")
async def delete_resource(id: int, user: User = Depends(require_admin)):
    # Only admins can delete resources
    return {"status": "deleted", "id": id}</code></pre>
            </section>

            <!-- API Reference Section -->
            <section id="api-reference" class="doc-section">
                <h2>API Reference</h2>

                <h3>Client SDK Reference</h3>

                <div class="api-method">
                    <h4><code>OpenKit403Client</code></h4>
                    <p>Main client class for wallet authentication.</p>

                    <h5>Constructor</h5>
                    <pre><code class="language-typescript">new OpenKit403Client(options?: { wallet?: WalletProvider })</code></pre>

                    <h5>Methods</h5>
                    
                    <div class="method-detail">
                        <code>connect(wallet: WalletProvider): Promise&lt;void&gt;</code>
                        <p>Connect to a Solana wallet.</p>
                        <ul>
                            <li><strong>wallet:</strong> Wallet provider ('phantom', 'backpack', 'solflare')</li>
                        </ul>
                    </div>

                    <div class="method-detail">
                        <code>disconnect(): Promise&lt;void&gt;</code>
                        <p>Disconnect from the current wallet.</p>
                    </div>

                    <div class="method-detail">
                        <code>isConnected(): boolean</code>
                        <p>Check if wallet is currently connected.</p>
                    </div>

                    <div class="method-detail">
                        <code>getAddress(): string | null</code>
                        <p>Get the connected wallet's public address.</p>
                    </div>

                    <div class="method-detail">
                        <code>signChallenge(challengeBase64url: string): Promise&lt;SignatureResult&gt;</code>
                        <p>Sign a challenge with the connected wallet.</p>
                        <ul>
                            <li><strong>challengeBase64url:</strong> Base64url-encoded challenge from server</li>
                            <li><strong>Returns:</strong> <code>{ signature: string, address: string }</code></li>
                        </ul>
                    </div>

                    <div class="method-detail">
                        <code>authenticate(options: AuthOptions): Promise&lt;AuthResult&gt;</code>
                        <p>Authenticate against a protected resource. Handles complete 403 flow automatically.</p>
                        <ul>
                            <li><strong>options.resource:</strong> API endpoint URL</li>
                            <li><strong>options.method:</strong> HTTP method (default: 'GET')</li>
                            <li><strong>options.headers:</strong> Additional headers</li>
                            <li><strong>options.wallet:</strong> Wallet provider (if not connected)</li>
                            <li><strong>Returns:</strong> <code>AuthResult</code> with ok status and response</li>
                        </ul>
                    </div>
                </div>

                <h3>Server SDK Reference</h3>

                <div class="api-method">
                    <h4><code>OpenKit403Middleware</code></h4>
                    <p>FastAPI middleware for wallet authentication.</p>

                    <h5>Configuration</h5>
                    <pre><code class="language-python">OpenKit403Middleware(
    audience: str,
    issuer: str,
    ttl_seconds: int = 60,
    clock_skew_seconds: int = 120,
    bind_method_path: bool = True,
    origin_binding: bool = False,
    replay_backend: str = "memory",
    realm: str = "protected",
)</code></pre>
                </div>

                <div class="api-method">
                    <h4><code>require_openkitx403_user</code></h4>
                    <p>FastAPI dependency for protected endpoints.</p>
                    <pre><code class="language-python">from openkitx403 import require_openkitx403_user, User

@app.get("/protected")
async def protected(user: User = Depends(require_openkitx403_user)):
    # user.address contains authenticated wallet address
    return {"address": user.address}</code></pre>
                </div>

                <div class="api-method">
                    <h4><code>User</code></h4>
                    <p>Authenticated user type.</p>
                    <pre><code class="language-python">class User:
    address: str      # Base58-encoded Solana public key
    challenge: dict   # Original challenge data</code></pre>
                </div>

                <h3>Agent SDK Reference</h3>

                <div class="api-method">
                    <h4><code>OpenKit403Agent</code></h4>
                    <p>Main agent class for autonomous wallet management and authentication.</p>

                    <h5>Constructor</h5>
                    <pre><code class="language-typescript">new OpenKit403Agent(config?: {
  provider?: 'local' | 'managed' | 'kms';
  privateKey?: string;
  wallet?: AgentWallet;
})</code></pre>

                    <h5>Methods</h5>
                    
                    <div class="method-detail">
                        <code>authenticate(request: AgentRequest): Promise&lt;AgentResponse&gt;</code>
                        <p>Authenticate and execute an API request with the agent's wallet.</p>
                    </div>

                    <div class="method-detail">
                        <code>getAddress(): string</code>
                        <p>Get the agent's wallet address.</p>
                    </div>

                    <div class="method-detail">
                        <code>exportPrivateKey(): string</code>
                        <p>Export the agent's private key (Base58 format).</p>
                    </div>
                </div>

                <div class="api-method">
                    <h4><code>AgentWalletManager</code></h4>
                    <p>Manage multiple agent wallets and coordinate requests.</p>

                    <div class="method-detail">
                        <code>generateWallet(agentId: string): AgentWallet</code>
                        <p>Generate a new wallet for an agent.</p>
                    </div>

                    <div class="method-detail">
                        <code>authenticateAll(request: AgentRequest): Promise&lt;AgentResponse[]&gt;</code>
                        <p>Execute parallel requests with all managed agents.</p>
                    </div>

                    <div class="method-detail">
                        <code>listWallets(): string[]</code>
                        <p>List all agent IDs and their wallets.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>OpenKitx403</h4>
                    <p>HTTP-native wallet authentication for Solana</p>
                    <p class="footer-license">MIT License ‚Ä¢ Open Source ‚Ä¢ Production Ready</p>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="https://github.com/openkitx403/openkitx403" target="_blank" rel="noopener">GitHub</a></li>
                        <li><a href="#protocol-spec">Protocol Spec</a></li>
                        <li><a href="#examples">Examples</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Community</h4>
                    <ul>
                        <li><a href="https://x.com/openkitx403" target="_blank" rel="noopener">Twitter</a></li>
                        <li><a href="https://github.com/openkitx403/openkitx403/issues" target="_blank" rel="noopener">Report Issue</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/prism.js"></script>
    <script src="js/main.js"></script>
</body>
</html>

